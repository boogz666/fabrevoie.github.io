<script>
    // Cookie consent functions
    function acceptCookies() {
        const cookieBanner = document.getElementById('cookieBanner');
        if (cookieBanner) {
            cookieBanner.style.display = 'none';
        }
        localStorage.setItem('cookieConsent', 'accepted');
        gtag('consent', 'update', {
            'ad_storage': 'granted',
            'analytics_storage': 'granted'
        });
    }

    function closeCookieBanner() {
        const cookieBanner = document.getElementById('cookieBanner');
        if (cookieBanner) {
            cookieBanner.style.display = 'none';
        }
        localStorage.setItem('cookieConsent', 'declined');
        gtag('consent', 'update', {
            'ad_storage': 'denied',
            'analytics_storage': 'denied'
        });
    }

    // Function to track form submission
    function trackFormSubmission() {
        console.log("Form submitted! Setting formSubmitted to true.");
        localStorage.setItem('formSubmitted', 'true');
    }

    // Listen for MailerLite form submission
    document.addEventListener('ml-subscribe', function(event) {
        console.log("MailerLite form submission event detected.");
        if (event.detail && event.detail.success) {
            console.log("Form submission was successful.");
            trackFormSubmission(); // Track the submission
            const mailerLiteForm = document.getElementById('mailerLiteForm');
            if (mailerLiteForm) {
                console.log("Hiding the MailerLite form.");
                mailerLiteForm.style.display = 'none'; // Hide the form
            }
        }
    });

    // Fallback: Hide the form after submission
    const mailerLiteForm = document.getElementById('mailerLiteForm');
    if (mailerLiteForm) {
        mailerLiteForm.addEventListener('submit', function() {
            console.log("Form submitted (fallback). Setting formSubmitted to true.");
            localStorage.setItem('formSubmitted', 'true');
            mailerLiteForm.style.display = 'none';
        });
    }

    // Check if the user has already made a choice
    document.addEventListener('DOMContentLoaded', function() {
        const consent = localStorage.getItem('cookieConsent');
        const cookieBanner = document.getElementById('cookieBanner');

        if (consent === 'accepted' || consent === 'declined') {
            if (cookieBanner) {
                cookieBanner.style.display = 'none';
            }
            gtag('consent', 'update', {
                'ad_storage': consent === 'accepted' ? 'granted' : 'denied',
                'analytics_storage': consent === 'accepted' ? 'granted' : 'denied'
            });
        }

        // Ensure video plays
        const video = document.querySelector('.bg-video');
        if (video) {
            video.play().catch(function(error) {
                console.log("Video play failed:", error);
                document.body.style.backgroundColor = "#000000";
            });
        }

        // Check if the user has already submitted the form
        console.log("Page loaded. Checking for form submission.");
        const formSubmitted = localStorage.getItem('formSubmitted');
        if (formSubmitted === 'true') {
            console.log("Form already submitted. Hiding the MailerLite form.");
            const mailerLiteForm = document.getElementById('mailerLiteForm');
            if (mailerLiteForm) {
                mailerLiteForm.style.display = 'none';
            }
        }
    });
</script>
