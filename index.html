});
            }
        }
        
        // Countdown to August 21 2025
        const countdownDate = new Date('2025-08-21T00:00:00').getTime();

        function updateCountdown() {
            const now = new Date().getTime();
            const distance = countdownDate - now;
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            document.getElementById('days').textContent = days;
        }

        // Play access granted sound after signup
        document.addEventListener('ml-subscribe', function(event) {
            if (event.detail.success) {
                document.getElementById('accessSound').play();
            }
        });

        // Function to show Under Construction Container and hide signup form
        function showUnderConstruction() {
            const mailerLiteForm = document.getElementById('mailerLiteForm');
            const signupText = document.getElementById('signupText');
            const underConstructionContainer = document.getElementById('underConstructionContainer');

            if (mailerLiteForm && signupText && underConstructionContainer) {
                mailerLiteForm.style.display = 'none';
                signupText.style.display = 'none';
                underConstructionContainer.style.display = 'flex';
            }
        }

        // Apply blur effect for page transitions
        function applyBlurEffect() {
            const blurOverlay = document.getElementById('blurOverlay');
            if (blurOverlay) {
                blurOverlay.classList.add('blur-active');
            }
        }

        // Remove blur effect
        function removeBlurEffect() {
            const blurOverlay = document.getElementById('blurOverlay');
            if (blurOverlay) {
                blurOverlay.classList.remove('blur-active');
            }
        }

        // Check if user has already signed up
        document.addEventListener('DOMContentLoaded', function() {
            // Start the loading sequence
            preloadAssets().then(() => {
                showPageContent();
                
                // Start countdown and video after loading is complete
                updateCountdown();
                setInterval(updateCountdown, 1000);
                
                const video = document.getElementById('bgVideo');
                if (video) {
                    video.play().catch(function(error) {
                        console.log("Video play failed:", error);
                    });
                }
                
                // Setup dynamic environment mapping
                setupDynamicEnvironment();
            });
            
            // Add error listener for 3D model
            const modelViewer = document.getElementById('logoModel');
            if (modelViewer) {
                modelViewer.addEventListener('error', (event) => {
                    console.error('3D model loading error:', event.detail);
                    // You could add additional error handling here
                });
            }
            
            const formSubmitted = localStorage.getItem('formSubmitted');
            if (formSubmitted === 'true') {
                showUnderConstruction();
            }
            
            // Check cookie consent
            const consent = localStorage.getItem('cookieConsent');
            const cookieBanner = document.getElementById('cookieBanner');

            if (consent === 'accepted' || consent === 'declined') {
                if (cookieBanner) {
                    cookieBanner.style.display = 'none';
                }
                if (typeof gtag === 'function') {
                    gtag('consent', 'update', {
                        'ad_storage': consent === 'accepted' ? 'granted' : 'denied',
                        'analytics_storage': consent === 'accepted' ? 'granted' : 'denied'
                    });
                }
            }
        });

        // Handle form submission
        document.addEventListener('ml-subscribe', function(event) {
            if (event.detail && event.detail.success) {
                localStorage.setItem('formSubmitted', 'true');
                showUnderConstruction();
            }
        });

        // Cookie functions
        function acceptCookies() {
            localStorage.setItem('cookieConsent', 'accepted');
            document.getElementById('cookieBanner').style.display = 'none';
            if (typeof gtag === 'function') {
                gtag('consent', 'update', {
                    'ad_storage': 'granted',
                    'analytics_storage': 'granted'
                });
            }
        }

        function closeCookieBanner() {
            localStorage.setItem('cookieConsent', 'declined');
            document.getElementById('cookieBanner').style.display = 'none';
            if (typeof gtag === 'function') {
                gtag('consent', 'update', {
                    'ad_storage': 'denied',
                    'analytics_storage': 'denied'
                });
            }
        }

        // Page transition logic with loading effect and access restriction
        document.addEventListener('DOMContentLoaded', function() {
            const links = document.querySelectorAll('a');
            links.forEach(link => {
                if ((link.hostname === window.location.hostname || link.hostname === '') && !link.target) {
                    link.addEventListener('click', function(e) {
                        const href = link.getAttribute('href');
                        
                        // Only allow navigation to privacy-policy.html, block other pages
                        if (href && href.endsWith('.html')) {
                            e.preventDefault();
                            
                            // Apply blur effect
                            applyBlurEffect();
                            
                            // Allow access only to privacy policy page
                            if (href === 'privacy-policy.html') {
                                // Store the destination URL in session storage
                                sessionStorage.setItem('nextPage', href);
                                
                                // Navigate to the privacy policy page after a short delay
                                setTimeout(() => {
                                    window.location.href = href;
                                }, 500);
                            } else if (href === 'index.html' || href === './index.html' || href === '/index.html') {
                                // Allow navigation back to the index page
                                setTimeout(() => {
                                    window.location.href = href;
                                }, 500);
                            } else {
                                // Show under construction message for all other pages
                                removeBlurEffect();
                                
                                // Check if already signed up
                                const formSubmitted = localStorage.getItem('formSubmitted');
                                if (formSubmitted === 'true') {
                                    // Show under construction message if not already showing
                                    showUnderConstruction();
                                    
                                    // Add a subtle bounce animation to the under construction container to draw attention
                                    const constructionContainer = document.getElementById('underConstructionContainer');
                                    if (constructionContainer) {
                                        constructionContainer.style.animation = 'none';
                                        void constructionContainer.offsetWidth; // Trigger reflow
                                        constructionContainer.style.animation = 'bounce 0.5s';
                                    }
                                }
                            }
                        }
                    });
                }
            });
        });
        
        // Safety measure to ensure the site loads even if assets fail
        setTimeout(function() {
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen && loadingScreen.style.display !== 'none') {
                console.log("Loading screen stuck, forcing display of content");
                showPageContent();
            }
        }, 10000); // Force content to show after 10 seconds
    </script>
</body>
</html>
